<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Space Invaders</title>
<style>
  html,body{margin:0;background:#000;color:#0f0;font-family:monospace}
  #gameCanvas{background:#000;display:block;margin:0 auto;border:1px solid #0f0}
  #ui{text-align:center;padding:4px}
</style>
</head>
<body>
  <div id="ui">Score: <span id="score">0</span> â€‘ Lives: <span id="lives">3</span></div>
  <canvas id="gameCanvas" width="480" height="640"></canvas>

<script>
/* ---------- CONFIG ---------- */
const W = 480, H = 640;
const PLAYER_W = 40, PLAYER_H = 20;
const BULLET_W = 4, BULLET_H = 10;
const ALIEN_W = 30, ALIEN_H = 20;
const ALIEN_ROWS = 5, ALIEN_COLS = 10;
const ALIEN_SPEED = 20; // px per second
const ALIEN_DROP = 20;  // px per step down

/* ---------- CANVAS & INPUT ---------- */
const cvs = document.getElementById('gameCanvas');
const ctx = cvs.getContext('2d');
const keys = {};
onkeydown = e => keys[e.code] = true;
onkeyup   = e => keys[e.code] = false;

/* ---------- GAME OBJECTS ---------- */
let player = { x: W/2 - PLAYER_W/2, y: H - 60, vx: 0 };
let bullets = [];
let aliens = [];
let alienBullets = [];
let alienDir = 1; // 1 right, -1 left
let lastAlienMove = 0;
let score = 0, lives = 3;
let gameOver = false;

/* ---------- INIT ---------- */
function initAliens() {
  aliens = [];
  for (let r = 0; r < ALIEN_ROWS; r++) {
    for (let c = 0; c < ALIEN_COLS; c++) {
      aliens.push({
        x: c * (ALIEN_W + 10) + 40,
        y: r * (ALIEN_H + 10) + 40,
        alive: true,
        type: r === 0 ? 30 : r < 3 ? 20 : 10 // different points
      });
    }
  }
}
initAliens();

/* ---------- LOOP ---------- */
let last = 0;
function gameLoop(timestamp) {
  if (last === 0) last = timestamp;
  const dt = (timestamp - last) / 1000;
  last = timestamp;

  if (!gameOver) {
    update(dt);
    draw();
  } else {
    ctx.fillStyle = '#fff';
    ctx.font = '40px monospace';
    ctx.textAlign = 'center';
    ctx.fillText('GAME OVER', W/2, H/2);
    ctx.fillText('Press R to restart', W/2, H/2 + 50);
    if (keys['KeyR']) restart();
  }
  requestAnimationFrame(gameLoop);
}
requestAnimationFrame(gameLoop);

/* ---------- UPDATE ---------- */
function update(dt) {
  /* player movement */
  player.vx = 0;
  if (keys['ArrowLeft'])  player.vx = -300;
  if (keys['ArrowRight']) player.vx = 300;
  player.x += player.vx * dt;
  player.x = Math.max(0, Math.min(W - PLAYER_W, player.x));

  /* player shoot */
  if (keys['Space'] && !bullets.find(b => b.fromPlayer)) {
    bullets.push({
      x: player.x + PLAYER_W/2 - BULLET_W/2,
      y: player.y,
      vy: -500,
      fromPlayer: true
    });
    keys['Space'] = false; // one shot per press
  }

  /* bullets */
  bullets.forEach(b => b.y += b.vy * dt);
  bullets = bullets.filter(b => b.y > -BULLET_H && b.y < H);

  /* aliens move & shoot */
  lastAlienMove += dt;
  const moveInterval = 0.5; // seconds
  if (lastAlienMove > moveInterval) {
    lastAlienMove = 0;
    let hitEdge = false;
    aliens.forEach(a => {
      if (!a.alive) return;
      a.x += ALIEN_SPEED * alienDir * moveInterval;
      if (a.x <= 0 || a.x + ALIEN_W >= W) hitEdge = true;
    });
    if (hitEdge) {
      alienDir *= -1;
      aliens.forEach(a => a.y += ALIEN_DROP);
    }
    /* random alien shoots */
    const shooters = aliens.filter(a => a.alive);
    if (shooters.length && Math.random() < 0.3) {
      const a = shooters[Math.floor(Math.random()*shooters.length)];
      alienBullets.push({
        x: a.x + ALIEN_W/2 - BULLET_W/2,
        y: a.y + ALIEN_H,
        vy: 300,
        fromPlayer: false
      });
    }
  }

  /* alien bullets */
  alienBullets.forEach(b => b.y += b.vy * dt);
  alienBullets = alienBullets.filter(b => b.y > -BULLET_H && b.y < H);

  /* collisions */
  bullets.forEach((b, bi) => {
    if (!b.fromPlayer) return;
    aliens.forEach(a => {
      if (!a.alive) return;
      if (rectIntersect(b, a)) {
        a.alive = false;
        bullets.splice(bi, 1);
        score += a.type;
        updateUI();
      }
    });
  });

  alienBullets.forEach((b, bi) => {
    if (b.fromPlayer) return;
    if (rectIntersect(b, player)) {
      alienBullets.splice(bi, 1);
      lives--;
      updateUI();
      if (lives <= 0) gameOver = true;
    }
  });

  /* alien reaches bottom */
  if (aliens.some(a => a.alive && a.y + ALIEN_H >= player.y)) {
    gameOver = true;
  }

  /* win */
  if (aliens.every(a => !a.alive)) {
    initAliens();
    alienDir = 1;
    alienSpeed *= 1.1; // next wave harder
  }
}

/* ---------- DRAW ---------- */
function draw() {
  ctx.clearRect(0, 0, W, H);
  /* player */
  ctx.fillStyle = '#0f0';
  ctx.fillRect(player.x, player.y, PLAYER_W, PLAYER_H);

  /* bullets */
  ctx.fillStyle = '#fff';
  bullets.forEach(b => ctx.fillRect(b.x, b.y, BULLET_W, BULLET_H));
  ctx.fillStyle = '#f00';
  alienBullets.forEach(b => ctx.fillRect(b.x, b.y, BULLET_W, BULLET_H));

  /* aliens */
  ctx.fillStyle = '#0f0';
  aliens.forEach(a => {
    if (a.alive) ctx.fillRect(a.x, a.y, ALIEN_W, ALIEN_H);
  });
}

/* ---------- UTILS ---------- */
function rectIntersect(a, b) {
  return a.x < b.x + ALIEN_W &&
         a.x + BULLET_W > b.x &&
         a.y < b.y + ALIEN_H &&
         a.y + BULLET_H > b.y;
}
function updateUI() {
  document.getElementById('score').textContent = score;
  document.getElementById('lives').textContent = lives;
}
function restart() {
  score = 0; lives = 3;
  initAliens();
  alienDir = 1;
  alienSpeed = 20;
  bullets = []; alienBullets = [];
  gameOver = false;
  updateUI();
}
</script>
</body>
</html>
